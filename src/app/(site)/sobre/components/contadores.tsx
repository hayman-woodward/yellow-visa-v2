'use client';

import { useEffect, useState } from 'react';

const contadores = [
  {
    id: 1,
    icon: (
      <svg
        width='40'
        height='41'
        viewBox='0 0 40 41'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
      >
        <path
          d='M20 23.8335C19.0795 23.8335 18.3333 23.0873 18.3333 22.1668V16.3335C18.3333 15.413 19.0795 14.6668 20 14.6668C20.9205 14.6668 21.6667 15.413 21.6667 16.3335V22.1668C21.6667 23.0873 20.9205 23.8335 20 23.8335Z'
          fill='#FFBD1A'
        />
        <path
          fillRule='evenodd'
          clipRule='evenodd'
          d='M26.1193 3.99798C26.4132 3.12535 25.9452 2.1727 25.0517 1.95015C23.4342 1.54732 21.7422 1.3335 20 1.3335C18.2628 1.3335 16.5755 1.5461 14.9623 1.9467C14.0686 2.16861 13.5998 3.12095 13.8932 3.9938C14.1864 4.86648 15.1305 5.32788 16.0273 5.11971C16.7785 4.94533 17.5483 4.81933 18.3333 4.74516V7.25838C10.8334 8.08745 5 14.4459 5 22.1668C5 30.4512 11.7157 37.1668 20 37.1668C28.2843 37.1668 35 30.4512 35 22.1668C35 18.6252 33.7725 15.3701 31.7198 12.804L33.2592 11.2648C33.91 10.6139 33.91 9.55861 33.2592 8.90775C32.6083 8.25686 31.553 8.25686 30.9022 8.90775L29.3628 10.447C27.2048 8.7208 24.5598 7.5782 21.6667 7.25838V4.74516C22.4557 4.81971 23.2295 4.94663 23.9843 5.12243C24.881 5.33121 25.8255 4.87046 26.1193 3.99798ZM20 33.8335C26.4433 33.8335 31.6667 28.6102 31.6667 22.1668C31.6667 15.7235 26.4433 10.5002 20 10.5002C13.5567 10.5002 8.33333 15.7235 8.33333 22.1668C8.33333 28.6102 13.5567 33.8335 20 33.8335Z'
          fill='#FFBD1A'
        />
      </svg>
    ),
    number: 100000,
    suffix: 'k',
    description: 'Mais de 100 mil horas aceleradas.'
  },
  {
    id: 2,
    icon: (
      <svg
        width='40'
        height='41'
        viewBox='0 0 40 41'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
      >
        <path
          d='M28.3327 28.8332V35.4998H34.9993V28.8332H28.3327ZM38.3327 35.4998C38.3327 37.3408 36.8403 38.8332 34.9993 38.8332H28.3327C26.4917 38.8332 24.9993 37.3408 24.9993 35.4998V28.8332C24.9993 26.9922 26.4917 25.4998 28.3327 25.4998H34.9993C36.8403 25.4998 38.3327 26.9922 38.3327 28.8332V35.4998Z'
          fill='#FFBD1A'
        />
        <path
          d='M4.99935 28.8332V35.4998H11.666V28.8332H4.99935ZM14.9993 35.4998C14.9993 37.3408 13.507 38.8332 11.666 38.8332H4.99935C3.1584 38.8332 1.66602 37.3408 1.66602 35.4998V28.8332C1.66602 26.9922 3.1584 25.4998 4.99935 25.4998H11.666C13.507 25.4998 14.9993 26.9922 14.9993 28.8332V35.4998Z'
          fill='#FFBD1A'
        />
        <path
          d='M16.666 5.49984V12.1665H23.3327V5.49984H16.666ZM26.666 12.1665C26.666 14.0075 25.1736 15.4998 23.3327 15.4998H16.666C14.8251 15.4998 13.3327 14.0075 13.3327 12.1665V5.49984C13.3327 3.65889 14.8251 2.1665 16.666 2.1665H23.3327C25.1736 2.1665 26.666 3.65889 26.666 5.49984V12.1665Z'
          fill='#FFBD1A'
        />
        <path
          d='M29.9993 27.1665V22.1665H9.99935V27.1665C9.99935 28.087 9.25316 28.8332 8.33268 28.8332C7.41221 28.8332 6.66602 28.087 6.66602 27.1665V22.1665C6.66602 21.2824 7.01746 20.4349 7.64258 19.8097C8.2677 19.1846 9.11529 18.8332 9.99935 18.8332H18.3327V13.8332C18.3327 12.9127 19.0789 12.1665 19.9993 12.1665C20.9198 12.1665 21.666 12.9127 21.666 13.8332V18.8332H29.9993C30.8834 18.8332 31.731 19.1846 32.3561 19.8097C32.9812 20.4349 33.3327 21.2824 33.3327 22.1665V27.1665C33.3327 28.087 32.5865 28.8332 31.666 28.8332C30.7455 28.8332 29.9993 28.087 29.9993 27.1665Z'
          fill='#FFBD1A'
        />
      </svg>
    ),
    number: 500,
    suffix: '',
    description: 'Mais de 500 Processos Automatizados.'
  },
  {
    id: 3,
    icon: (
      <svg
        width='40'
        height='41'
        viewBox='0 0 40 41'
        fill='none'
        xmlns='http://www.w3.org/2000/svg'
      >
        <path
          fillRule='evenodd'
          clipRule='evenodd'
          d='M9.99935 3.8335C8.1584 3.8335 6.66602 5.32588 6.66602 7.16683V33.8335C6.66602 35.6745 8.1584 37.1668 9.99935 37.1668H29.9993C31.8403 37.1668 33.3327 35.6745 33.3327 33.8335V7.16683C33.3327 5.32588 31.8403 3.8335 29.9993 3.8335H9.99935ZM29.9993 7.16683H9.99935V33.8335H29.9993V7.16683Z'
          fill='#FFBD1A'
        />
        <path
          d='M23.2438 15.6148C23.6772 15.4814 24.1594 15.4455 24.5547 15.6099L24.6326 15.6452L24.7008 15.6868C24.7653 15.7334 24.8182 15.7949 24.8541 15.8668C25.0585 16.2755 25.0269 16.7933 24.8846 17.2556C24.7368 17.7361 24.4463 18.2396 24.0182 18.6677L22.4761 20.2094L23.3096 24.0068C23.4035 24.4765 23.1956 24.864 22.8756 25.104C22.8409 25.13 22.8027 25.1512 22.7624 25.1674L22.5148 25.2665C22.103 25.4312 21.5998 25.3678 21.2904 24.9555C21.2845 24.9476 21.2789 24.939 21.2735 24.9308L19.8135 22.7205L18.9622 23.2885V24.5095C18.9622 24.6408 18.9099 24.7668 18.817 24.8597L18.3217 25.355C18.2167 25.46 18.0703 25.5124 17.9226 25.4978C17.7749 25.4831 17.6416 25.403 17.5593 25.2796L16.6233 23.8757L15.2199 22.9402C15.0965 22.8579 15.0164 22.7245 15.0018 22.5769C14.9871 22.4292 15.0395 22.2827 15.1445 22.1778L15.6398 21.6824L15.6761 21.6495C15.7642 21.5773 15.8751 21.5373 15.99 21.5373H17.211L17.7784 20.6854L15.5687 19.2259C15.5605 19.2205 15.5519 19.2149 15.544 19.209C15.1318 18.8997 15.0683 18.3965 15.233 17.9846C15.2428 17.9602 15.2548 17.9366 15.2683 17.914L15.4168 17.6663C15.615 17.3033 15.9918 17.1234 16.3993 17.1739L16.4835 17.1879L20.2896 18.0229L21.8317 16.4812C22.2598 16.0531 22.7633 15.7626 23.2438 15.6148ZM24.0061 16.4928C23.8907 16.4865 23.7323 16.5012 23.535 16.5619C23.2106 16.6618 22.8471 16.8667 22.5322 17.1816L20.7984 18.9154C20.679 19.0348 20.5068 19.0851 20.3418 19.0489L16.289 18.1593C16.2857 18.1653 16.2698 18.1703 16.2663 18.1762L16.1463 18.376C16.1404 18.3963 16.1387 18.4091 16.139 18.4157L18.7396 20.1335C18.8496 20.2061 18.9264 20.3192 18.9525 20.4484C18.9786 20.5775 18.952 20.7117 18.879 20.8214L17.8883 22.3074C17.7964 22.4452 17.6417 22.528 17.4761 22.528H16.3877L17.2555 23.1066L17.2947 23.1356C17.3325 23.1666 17.3657 23.2031 17.3929 23.244L17.9715 24.1118V23.0234C17.9715 22.8578 18.0542 22.7031 18.192 22.6112L19.6781 21.6205L19.7202 21.5953C19.8211 21.5417 19.938 21.5241 20.0511 21.547C20.1802 21.5731 20.2934 21.6499 20.366 21.7598L22.0833 24.3605C22.0917 24.3609 22.1127 24.3605 22.1466 24.3469L22.3164 24.2787C22.3331 24.2618 22.3411 24.2492 22.3411 24.2492C22.3415 24.2456 22.3437 24.2283 22.3401 24.2105L21.4505 20.1576C21.4143 19.9927 21.4646 19.8204 21.584 19.701L23.3178 17.9672C23.6327 17.6523 23.8376 17.2888 23.9375 16.9644C23.9983 16.7668 24.0125 16.6082 24.0061 16.4928Z'
          fill='#FFBD1A'
        />
        <path
          fillRule='evenodd'
          clipRule='evenodd'
          d='M16.289 18.1593C16.2857 18.1612 16.2719 18.1717 16.2663 18.1762L16.289 18.1593C16.2939 18.1565 16.2873 18.1624 16.289 18.1593Z'
          fill='#FFBD1A'
        />
        <path
          d='M23.535 16.5619C23.7323 16.5012 23.8907 16.4865 24.0061 16.4928C24.0125 16.6082 23.9983 16.7668 23.9375 16.9644C23.8376 17.2888 23.6327 17.6523 23.3178 17.9672L21.584 19.701C21.4646 19.8204 21.4143 19.9927 21.4505 20.1576L22.3401 24.2105C22.3437 24.2283 22.3415 24.2456 22.3411 24.2492C22.3411 24.2492 22.3331 24.2618 22.3164 24.2787L22.1466 24.3469C22.1127 24.3605 22.0917 24.3609 22.0833 24.3605L20.366 21.7598C20.2934 21.6499 20.1802 21.5731 20.0511 21.547C19.938 21.5241 19.8211 21.5417 19.7202 21.5953L19.6781 21.6205L18.192 22.6112C18.0542 22.7031 17.9715 22.8578 17.9715 23.0234V24.1118L17.3929 23.244C17.3657 23.2031 17.3325 23.1666 17.2947 23.1356L17.2555 23.1066L16.3877 22.528H17.4761C17.6417 22.528 17.7964 22.4452 17.8883 22.3074L18.879 20.8214C18.952 20.7117 18.9786 20.5775 18.9525 20.4484C18.9264 20.3192 18.8496 20.2061 18.7396 20.1335L16.139 18.4157C16.1387 18.4091 16.1404 18.3963 16.1463 18.376L16.2663 18.1762C16.268 18.1733 16.2843 18.162 16.289 18.1593C16.2873 18.1624 16.2939 18.1565 16.289 18.1593L20.3418 19.0489C20.5068 19.0851 20.679 19.0348 20.7984 18.9154L22.5322 17.1816C22.8471 16.8667 23.2106 16.6618 23.535 16.5619Z'
          fill='#FFBD1A'
        />
      </svg>
    ),
    number: 1000,
    suffix: '',
    description: 'Vistos aprovados em 2023 para Portugal e Estados Unidos.'
  }
];

export default function Contadores() {
  const [counts, setCounts] = useState([0, 0, 0]);
  const [isVisible, setIsVisible] = useState(false);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
        }
      },
      { threshold: 0.3 }
    );

    const element = document.getElementById('contadores-section');
    if (element) {
      observer.observe(element);
    }

    return () => {
      if (element) {
        observer.unobserve(element);
      }
    };
  }, []);

  useEffect(() => {
    if (isVisible) {
      const duration = 2000; // 2 segundos
      const steps = 60;
      const stepDuration = duration / steps;

      contadores.forEach((contador, index) => {
        const target = contador.number;
        const increment = target / steps;
        let current = 0;

        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            current = target;
            clearInterval(timer);
          }

          setCounts((prev) => {
            const newCounts = [...prev];
            newCounts[index] = Math.floor(current);
            return newCounts;
          });
        }, stepDuration);
      });
    }
  }, [isVisible]);

  const formatNumber = (num: number, suffix: string) => {
    if (suffix === 'k') {
      return `+${Math.floor(num / 1000)}k`;
    }
    return `+${num}${suffix}`;
  };

  return (
    <section
      id='contadores-section'
      className='relative py-10 md:py-0 md:px-8 xl:px-0' 
      style={{
        background:
          'linear-gradient(16deg, rgba(255, 103, 0, 0.20) 6.2%, rgba(255, 103, 0, 0.00) 73.66%), #0F0005'
      }}
    >
      <div className='max-w-[1248px] mx-auto px-4 sm:px-6 lg:px-8 xl:px-0 md:py-[120px]'>
        <div className='grid grid-cols-1 md:grid-cols-3 gp-6 md:gap-8 lg:gap-12'>
          {contadores.map((contador, index) => (
            <div
              key={contador.id}
              className='text-left py-5 md:py-10 px-4 md:px-5'
            >
              {/* Icon */}
              <div className='mb-2 md:mb-4'>{contador.icon}</div>

              {/* Number */}
              <div className='text-white text-[36px] md:text-[66px] text-4xl lg:text-11xl font-[900] md:font-[800] mb-2 md:mb-4'>
                {formatNumber(counts[index], contador.suffix)}
              </div>

              {/* Description */}
              <div className='text-white text-base leading-relaxed md:pb-1'>
                {contador.description}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}
